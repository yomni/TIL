# MVCC(Multi Version Concurrency Control) 와 팬텀 리드

<img src="https://github.com/yomni/TIL/blob/main/images/DB/MySQL/4_MVCC와_팬텀리드/1.png" style="width: 500px" />

## MVCC(Multi Version Concurrency Control) : 다중 버전 동시성 제어

InnoDB에서는 하나의 레코드에 대하여 언두로그와 버퍼풀을 이용한 다중 버전의 레코드를 가지고 있으며,  
이를 통해 효율적인 동시성 제어를 할 수 있다.

## 팬텀 리드(Phantom Read)

동일한 쿼리를 실행할 때 결과 집합이 다를 수 있는 상황을 의미한다.  
동일한 쿼리를 두 번 실행하면, 두 번째 실행에서는 이전과 다른 결과를 얻을 수 있다.  
이 현상은 트랜잭션 간의 동시성을 관리하는 동안 발생할 수 있다.

### 팬텀리드 예시

1. 트랜잭션 A가 특정 범위의 데이터를 쿼리한다.
2. 트랜잭션 B가 동일한 범위의 데이터를 추가하고 커밋한다.
3. 트랜잭션 A가 다시 범위를 쿼리하면, 새로 추가된 데이터 행이나 변경된 데이터가 결과 집합에 나타난다.

## MVCC와 팬텀 리드의 연관성

- **_MVCC는 팬텀 리드가 발생하기 위한 필요 조건이다._**
- 팬텀 리드가 발생하려면 MVCC와 낮은 격리수준이 필요하다.

## 격리 수준 별 발생 가능 현상

| 격리수준 \ 문제 유형           | Dirty      | Non-Repeatable | Phantom    | 고립수준 | 동시성 수준 |
| ------------------------------ | ---------- | -------------- | ---------- | -------- | ----------- |
| Read Uncommitted<br> (Level 0) | 가능       | 가능           | 가능       | 낮음     | 높음        |
| Read Committed<br> (Level 1)   | **불가능** | 가능           | 가능       |          |             |
| Repeatable Read<br> (Level 2)  | **불가능** | **불가능**     | 가능       |          |             |
| Serializable<br> (Level 3)     | **불가능** | **불가능**     | **불가능** | 높음     | 낮음        |

## 느낀점
MVCC엔 장점만 있고 단점은 없을거라 생각했는데,  
**격리수준**과 **지원하고자 하는 서비스의 방향성**에 따라 단점이 될 수도 있다는 것을 알게되었다.
